name: Create Release

#on:
#  push:
#    tags:
#      - "v*" # Push events to matching v*, i.e. v1.0, v20.15.10
#      - "vite-plugin-*" # Push events to matching vite-plugin-*, i.e. vite-plugin-(sugar)@1.0.0
#      - "create-arca*" # Push events to matching create-arca*, i.e. create-arca@1.0.0

on:
  push:
    branches:
      - "main"

env:
  CI: true
  PNPM_CACHE_FOLDER: .pnpm-store

jobs:
  version:
    timeout-minutes: 15
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup node.js
        uses: actions/setup-node@v2
        with:
          node-version: 14

      - name: Setup npmrc
        run: echo "//registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }}" > .npmrc

      - name: Install pnpm
        run: npm i pnpm@latest -g

      - name: Setup pnpm config
        run: pnpm config set store-dir $PNPM_CACHE_FOLDER

      - name: Install dependencies
        run: pnpm install

      - name: Setup git config
        uses: fregante/setup-git-user@v1

      - name: Read package.json
        uses: tyankatsu0105/read-package-version-actions@v1
        id: package-version

      - name: Get package
        uses: actions/github-script@v6
        id: found-package
        with:
          script: |
            const { getPackages } = require('@manypkg/get-packages')
            const { packages } = await getPackages(process.cwd())
            const foundPackage = packages.find(pkg => context.ref.includes(pkg.packageJson.name))
            console.log('foundPackage', foundPackage)
            console.log('packages', packages)
            console.log('context.ref', context.ref)
            return foundPackage

#      - name: Create release
#        id: create-release
#        uses: actions/create-release@v1
#        env:
#          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }} # This token is provided by Actions, you do not need to create your own token
#        with:
#          tag_name: ${{ github.ref }}
#        body: |
#          Please refer to [CHANGELOG.md](https://github.com/Spencer17x/arca/blob/main/packages/${{ steps.tag.outputs.pkgName }}/CHANGELOG.md) for details.
